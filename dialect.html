<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dialect Lexicon</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .term-page { max-width: 900px; margin: auto; padding: 2rem; }
    .search-bar { margin: 1.5rem 0 2rem; }
    .search-bar input { width: 100%; padding: 0.7rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px; }
    .feature { border-bottom: 1px solid #e5e7eb; padding: 1.2rem 0; }
    .word { font-weight: 700; font-size: 1.2rem; color: #1d4ed8; margin-bottom: 0.4rem; }
    .label { font-weight: 600; color: #374151; }
    .ipa { font-style: italic; color: #6b7280; }
    audio { margin: 0.4rem 0; display: block; }
    .example { margin-top: 0.6rem; padding-left: 1rem; }
    .example-text { display: block; margin-bottom: 0.2rem; }
    .dialect-profile img { max-width: 100%; margin-top: 0.5rem; border-radius: 6px; border: 1px solid #ccc; }
    table { border-collapse: collapse; width: 100%; margin-top: 0.8rem; }
    th, td { border: 1px solid #ccc; padding: 0.4rem 0.6rem; text-align: center; vertical-align: middle; }
    th { font-weight: normal; color: #111827; background-color: #f3f4f6; }
    h3.section-header { font-weight: 700; font-size: 1.2rem; color: #1d4ed8; margin-top: 2rem; margin-bottom: 1rem; }
    #dialectTitle { font-size: 2rem; font-weight: 700; color: #1d4ed8; margin-top: 2rem; margin-bottom: 1.5rem; }
  </style>
</head>
<body>

<header>
  <h1>Jeremy Johns</h1>
  <nav>
    <ul class="menu">
      <li><a href="index.html">Home</a></li>
      <li><a href="research.html">Research</a></li>
      <li><a href="cv.html">CV</a></li>
      <li><a href="teaching.html">Teaching/Outreach</a></li>
      <li class="dropdown">
        <a href="#">Language Resources ‚ñæ</a>
        <ul class="dropdown-menu">
          <li><a href="login.html?redirect=wordsearch.html">Reduplication Dictionary</a></li>
            <li><a href="neologisms.html">Linguistic Terminology</a></li>
            <li><a href="lab.html">'O'odham Lab</a></li>
            <li><a href="login.html?redirect=map.html">Dialect Map</a></li>
        </ul>
      </li>
    </ul>
  </nav>
</header>

<main class="term-page">
  <a href="map.html">‚Üê Back to Map</a>

  <h1 id="dialectTitle"></h1>

  <div id="dialectProfile"></div>
  

  <h3 class="section-header">Dialect Lexicon Search</h3>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search words in this dialect‚Ä¶">
  </div>
  <div id="results">
    <p>Please enter a search term above to find words in this dialect.</p>
  </div>
</main>

<footer>
  <p>¬© 2026 Jeremy Johns | <a href="mailto:jeremyjohns@arizona.edu">jeremyjohns@arizona.edu</a></p>
</footer>

<script src="lexicon.js"></script>
<script src="dialect_profiles.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const dialectId = params.get("dialect");

  const title = document.getElementById("dialectTitle");
  const profileContainer = document.getElementById("dialectProfile");
  const searchInput = document.getElementById("searchInput");
  const resultsDiv = document.getElementById("results");

  if (!dialectId) {
    title.textContent = "No dialect selected";
    return;
  }

  const profile = dialectProfiles[dialectId];
  if (!profile) {
    title.textContent = "No profile available for this dialect";
    return;
  }

  /* ---------- TITLE ---------- */
  title.textContent = profile.metadata?.label || profile.name || "Dialect";

  /* ---------- BUILD PROFILE HTML ---------- */
  let profileHTML = "";

  if (profile.metadata?.location) {
    profileHTML += `
      <p>
        <span class="metadata-label">Location:</span>
        ${profile.metadata.label || ""}<br>
        <em>Lat:</em> ${profile.metadata.location.lat},
        <em>Lng:</em> ${profile.metadata.location.lng}
      </p>
    `;
  }

  if (
    profile.phonology?.notes?.length ||
    profile.phonology?.allophony?.length ||
    profile.phonology?.phonemicInventoryCSV
  ) {
    profileHTML += `<h3 class="section-header">Phonology</h3>`;
    profileHTML += `
      <h4>Phonemic Inventory (IPA Chart)</h4>
      <div id="phonemicChart" style="margin-bottom:1.5rem;">Loading IPA chart‚Ä¶</div>
    `;
    if (profile.phonology.notes?.length) {
      profileHTML += `
        <h4>General notes</h4>
        <ul>${profile.phonology.notes.map(n => `<li>${n}</li>`).join("")}</ul>
      `;
    }
    if (profile.phonology.allophony?.length) {
      profileHTML += `<h4>Allophony</h4><ul>`;
      profile.phonology.allophony.forEach(rule => {
        profileHTML += `<li>${rule.label || ""}`;
        if (rule.items?.length) {
          profileHTML += `<ul>${rule.items.map(i => `<li>${i}</li>`).join("")}</ul>`;
        }
        profileHTML += `</li>`;
      });
      profileHTML += `</ul>`;
    }
  }

  if (profile.grammar?.morphology?.length || profile.grammar?.syntax?.length) {
    profileHTML += `<h3 class="section-header">Grammar</h3><ul>`;
    if (profile.grammar.morphology?.length) {
      profileHTML += profile.grammar.morphology
        .map(m => `<li><strong>Morphology:</strong> ${m}</li>`)
        .join("");
    }
    if (profile.grammar.syntax?.length) {
      profileHTML += profile.grammar.syntax
        .map(s => `<li><strong>Syntax:</strong> ${s}</li>`)
        .join("");
    }
    profileHTML += `</ul>`;
  }

  if (profile.maps?.trajectory) {
    profileHTML += `
      <h3 class="section-header">Phonetic Trajectory</h3>
      <img src="${profile.maps.trajectory}" alt="Phonetic trajectory map">
    `;
  }

  profileContainer.innerHTML = profileHTML;

  /* ---------- FETCH PHONEMIC INVENTORY CSV ---------- */
  if (profile.phonology?.phonemicInventoryCSV) {
    fetch(profile.phonology.phonemicInventoryCSV)
      .then(resp => resp.text())
      .then(csvData => {
        const delimiter = csvData.includes("\t") ? "\t" : ",";
        const rows = csvData.trim().split("\n");
        const headers = rows.shift().split(delimiter).map(h => h.trim());

        const chartHTML = `
          <table>
            <thead>
              <tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>
            </thead>
            <tbody>
              ${rows.map(r => {
                const cols = r.split(delimiter);
                return `<tr>${cols
                  .map(c => {
                    const val = c.trim();
                    if (val && (val.endsWith(".mp3") || val.endsWith(".wav"))) {
                      return `<td><audio controls preload="none" src="${val}"></audio></td>`;
                    }
                    return `<td>${val.replace(/ /g, "&nbsp;&nbsp;&nbsp;")}</td>`;
                  })
                  .join("")}</tr>`;
              }).join("")}
            </tbody>
          </table>
        `;

        const chartDiv = document.getElementById("phonemicChart");
        if (chartDiv) chartDiv.innerHTML = chartHTML;
      })
      .catch(() => {
        const chartDiv = document.getElementById("phonemicChart");
        if (chartDiv) chartDiv.innerHTML = "<p>Unable to load IPA chart.</p>";
      });
  }

  /* ---------- LEXICON FILTER ---------- */
  const dialectEntries = lexicon.filter(
    e => e.dialect_id === dialectId || e.dialect === "Any"
  );

  function render(entries) {
    resultsDiv.innerHTML = "";
    if (!entries.length) {
      resultsDiv.innerHTML = "<p>No matching entries.</p>";
      return;
    }

    const fragment = document.createDocumentFragment();

    entries.forEach(e => {
      const exampleSentences = e.examples ? e.examples.split("||") : [];
      const exampleAudios = e.example_audio ? e.example_audio.split("||") : [];
      let examplesHTML = "";

      exampleSentences.forEach((s, i) => {
        let formatted = s;
        if (s.includes("::")) {
          const [oodham, english] = s.split("::").map(x => x.trim());
          formatted = `<strong>${oodham}</strong> <em>${english}</em>`;
        }

        let exampleAudioHTML = "";
        if (exampleAudios[i]) {
          exampleAudioHTML = `
            <span class="audio-icon" onclick="document.getElementById('ex-${e.oodham}-${i}').play()">üîä</span>
            <audio id="ex-${e.oodham}-${i}" class="audio-hidden" src="${exampleAudios[i]}"></audio>
          `;
        }

        examplesHTML += `<div class="example">${formatted} ${exampleAudioHTML}</div>`;
      });

      let singAudioHTML = "";
      if (e.sing_audio) {
        singAudioHTML = `
          <span class="audio-icon" onclick="document.getElementById('sing-${e.oodham}').play()">üîä</span>
          <audio id="sing-${e.oodham}" class="audio-hidden" src="${e.sing_audio}"></audio>
        `;
      }

      let plAudioHTML = "";
      if (e.pl_audio) {
        plAudioHTML = `
          <span class="audio-icon" onclick="document.getElementById('pl-${e.oodham}').play()">üîä</span>
          <audio id="pl-${e.oodham}" class="audio-hidden" src="${e.pl_audio}"></audio>
        `;
      }

      const div = document.createElement("div");
      div.className = "feature";

      div.innerHTML = `
        <div class="word">${e.oodham} ${singAudioHTML}</div>
        <div><span class="label">English:</span> ${e.english}</div>
        <div><span class="label">Part of speech:</span> ${e.partOfSpeech || ""}</div>
        <div><span class="label">Pattern:</span> ${e.pattern || ""}</div>
        <div class="ipa">
          <span class="label">Pronunciation:</span> ${e.pronunciation}
          ${e.reduplicated ? `<br><span class="label">Reduplicated:</span> ${e.reduplicated} ${plAudioHTML}` : ""}
          ${e.redup_pronunciation ? `<br><span class="label">Redup Pronunciation:</span> ${e.redup_pronunciation}` : ""}
          ${e.redup_meaning ? `<br><span class="label">Redup Meaning:</span> ${e.redup_meaning}` : ""}
        </div>
        ${examplesHTML ? `<div class="label" style="margin-top:0.6rem;">Examples:</div>${examplesHTML}` : ""}
      `;

      fragment.appendChild(div);
    });

    resultsDiv.appendChild(fragment);
  }

  let searchTimeout;
  searchInput.addEventListener("input", () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const q = searchInput.value.trim().toLowerCase();
      if (!q) {
        resultsDiv.innerHTML = "<p>Start typing to search words in this dialect.</p>";
        return;
      }
      render(
        dialectEntries.filter(e =>
          Object.values(e).some(v =>
            typeof v === "string" && v.toLowerCase().includes(q)
          )
        )
      );
    }, 250);
  });
});
</script>




</body>
</html>
